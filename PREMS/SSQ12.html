<!DOCTYPE html>
<html lang="fr">
  <head>
    <!-- Author's details-->
    <meta name="author" content="Nicolas Vannson">
    <meta name="contact" content="hello@memau.eu">
    <meta name="license" content="EUPLv1.2">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.0/jspdf.umd.min.js"></script>
    <script src= https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="/style.css">
    <style>
      /* style is within the style.css sheet */
    </style>
  <title>SSQ12</title>
  </head>
  <body>
    <h1>SSQ12</h1>
    <p >Moulin et Richard, 2016</p>
    <p><b>Conseil pour répondre aux questions</b></p>
    <p class="Consignes_SSQ">Les questions suivantes concernent votre capacité et votre expérience en matière d’audition et d’écoute dans le cadre de
      situations diverses.<br>
      Déplacez le curseur (ou slider) situé à droite de chacune des questions, à l’endroit adéquat entre le 0 et le 10. Si le curseur se trouve au niveau de la valeur 10, cela signifie que vous êtes parfaitement capable de faire ou d’expérimenter ce qui est décrit dans la question correspondante. Si le curseur se trouve sur le 0, cela indique que vous n’êtes pratiquement pas en mesure de faire
      ni d’expérimenter ce qui est décrit.<br>
    <p style="text-align: left;"><b>Exemple</b></p> 
    <form id="DEMO">   
      <table>
        <thead>
        </thead>
        <tbody>
          <tr>
            <td class="Question_SSQ">
              0. Vous pouvez suivre une conversation avec une personne en face de vous, dans le calme ?
            </td>
            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Non, pas du tout</span>
                <span>Oui, parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q1">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>
            <td class="na-checkbox">
              <input type="checkbox" id="q1_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

        </tbody>
      </table>
    </form>
    <p class="Consignes_SSQ"> La question 0 se rapporte à votre capacité de suivre une conversation. Si vous êtes tout à fait capable de le faire, placez le curseur sur l’extrémité droite de l’échelle. Si vous êtes capable de suivre environ
      la moitié de la conversation dans une telle situation, placez le curseur  vers le milieu de l’échelle et ainsi de suite. <br>
      Nous espérons que toutes les questions sont pertinentes au regard de votre vie quotidienne. Si ce n’est pas le cas
      pour certaines questions, veuillez cocher la case « non applicable » (NA).</p>
    <br>
  
    <form id="SSQ12">

      <h3 class="Question_SSQ"> 1ère partie : Audition de la parole </h3>


      <table>
        <thead>
        </thead>
        <tbody>
          <tr>
            <td class="Question_SSQ">
              1. Vous discutez avec une autre personne dans une pièce dans laquelle un
              téléviseur est allumé. Pouvez-vous suivre les propos de votre interlocuteur sans baisser le son du téléviseur ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q1">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q1_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

          <tr>
            <td class="Question_SSQ">
              2. Vous êtes assis autour d’une table avec un groupe de cinq personnes environ, dans un restaurant animé. Vous pouvez voir toutes les personnes du groupe. Pouvez-vous suivre la conversation ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q2">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q2_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>
          <tr>
            <td class="Question_SSQ">
              3. Vous écoutez la personne qui vous parle tout en essayant simultanément de suivre les informations à la télévision. Pouvez-vous suivre ce que disent les deux personnes ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q3">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q3_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

          <tr>
            <td class="Question_SSQ">
              4. Vous discutez avec quelqu’un dans une pièce dans laquelle beaucoupd’autres personnes s’entretiennent.Pouvez-vous suivre ce que vous dit votre interlocuteur ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q4">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q4_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

          <tr>
            <td class="Question_SSQ">
              5. Vous êtes dans un groupe de personnes qui parlent les unes après les
              autres de façon improvisée. Pouvez-vous suivre la conversation entre ces personnes sans perdre le début des propos de chaque personne ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Concentration intense</span>
                <span>Pas de concentration</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q5">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q5_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

        </tbody>
      </table>



      <h3 class="Question_SSQ"> 2e partie : Audition spatiale </h3>


      <table>
        <thead>
        </thead>
        <tbody>
          <tr>
            <td class="Question_SSQ">
              6. Vous êtes à l’extérieur. Un chien aboie bruyamment. Pouvez-vous indiquer immédiatement où il se trouve, sans regarder ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q6">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q6_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

          <tr>
            <td class="Question_SSQ">
              7. Pouvez-vous indiquer immédiatement à quelle distance se trouve un bus ou un camion, juste en entendant le bruit qu’il fait ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q7">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q7_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>
          <tr>
            <td class="Question_SSQ">
              8. Pouvez-vous indiquer immédiatement à quelle distance se trouve un bus ou un camion, juste en entendant le
              bruit qu’il fait ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q8">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q8_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

        </tbody>
      </table>


      <h3 class="Question_SSQ"> 3e partie : Qualité d’audition </h3>


      <table>
        <thead>
        </thead>
        <tbody>
          <tr>
            <td class="Question_SSQ">
              9. Lorsque vous entendez plusieurs sons à la fois, pouvez-vous les distinguer
              clairement les uns des autres ou avez- vous l’impression qu’il s’agit d’un seul bruit confus ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q9">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q9_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

          <tr>
            <td class="Question_SSQ">
              10. Lorsque vous écoutez de la musique, pouvez-vous discerner les différents instruments ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q10">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q10_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>
          <tr>
            <td class="Question_SSQ">
              11. Les bruits quotidiens que vous entendez facilement sont-ils distincts (non brouillés) ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q11">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q11_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

          <tr>
            <td class="Question_SSQ">
              12. Devez-vous vous concentrerintensément lorsque vous écoutez quelqu’un ou quelque chose ?
            </td>

            <td class="Question_SSQ">
              <div class="SSQ_answer">
                <span>Pas du tout</span>
                <span>Parfaitement</span>
              </div>
              <input type="range" min="0" max="10" step="0.1" value="5" class="slider" id="q12">
              <div class="SSQ_answer">
                <span>0</span>
                <span>1</span>
                <span>2</span>
                <span>3</span>
                <span>4</span>
                <span>5</span>
                <span>6</span>
                <span>7</span>
                <span>8</span>
                <span>9</span>
                <span>10</span>
              </div>
            </td>

            <td class="na-checkbox">
              <input type="checkbox" id="q12_na">
              <span style="float: right;">Non appliquable</span>
            </td>
          </tr>

        </tbody>
      </table>

      <div class="buttons-container">
        <button type="button" onclick="calculerScores()">Calculer les scores</button>
        <button type="reset" onclick="resetForm()">Réinitialiser</button>
      </div>

    </form>

    <div id="results" style="display:none">
      <p id="scoreDisplay"></p><br>
      <label for="nameID" class="Subject_name">Nom du sujet (si besoin)</label>
      <input type="text" id="ID" name="nameID"><br>
      <button id="savePdfButton" onclick="savePdf()">Exporter en PDF</button>
      <button id="saveXLSbutton" onclick="saveXLS()">Exporter en XLS</button>
    </div>

    <script>
  
      // Sliders colors
      const sliders = document.querySelectorAll(".slider");
      sliders.forEach(function(slider) {
        slider.addEventListener("input", function () {
          const value = (this.value - this.min) / (this.max - this.min) * 100;
          this.style.background = `linear-gradient(to right, #2B176C ${value}%,  #eeeeee ${value}%)`;
        });

        // Appliquer le dégradé à l’état initial
        const initialValue = (slider.value - slider.min) / (slider.max - slider.min) * 100;
        slider.style.background = `linear-gradient(to right, #2B176C ${initialValue}%, #eeeeee ${initialValue}%)`;
      });


      let globalScore = null;


      function calculerScores() {
        let score = 0;
        let countNa = 0;

        // Slider and Na id
        const sliderIds = ["q1", "q2", "q3", "q4", "q5", "q6", "q7", "q8", "q9", "q10", "q11", "q12"];
        const naCheckboxIds = ["q1_na", "q2_na", "q3_na", "q4_na", "q5_na", "q6_na", "q7_na", "q8_na", "q9_na", "q10_na", "q11_na", "q12_na"];


        // Loop
        for (let i = 0; i < sliderIds.length; i++) {
          const slider = document.getElementById(sliderIds[i]);
          const naCheckbox = document.getElementById(naCheckboxIds[i]);

          if (naCheckbox.checked) {
            countNa++;
          } else {
            score += parseFloat(slider.value, 10);
          }
        }

        if (countNa === 12) {
          score = 0;
        } else {
          score = score / (12 - countNa);
        }

        displayscores(score);


        // Return score for xls and pdf
        globalScore = score;

      }


      function displayscores(score) {

        let display = "";
        display += "<p>Résultats</p>";
        display += "<p> Score total : " + score.toFixed(2) + "</p>";


        // Update the results div with the constructed HTML
        document.getElementById("scoreDisplay").innerHTML = display;
        document.getElementById("results").style.display = "block";
        document.getElementById('savePdfButton').style.display = 'inline-block';
        document.getElementById('saveXLSbutton').style.display = 'inline-block';

      }


      function saveXLS() {

        const subjectCode = document.getElementById('ID').value || "SansNom"; // Nom du sujet
        const today = new Date().toLocaleDateString('fr-FR');
        const filename = `SSQ12_${today}_${subjectCode}.csv`;

        //const scoreText = document.getElementById('scoreDisplay').textContent;
        //const totalScore = scoreText.replace('Le score total est ', '').trim();

        const safeScore = typeof globalScore === 'number' ? globalScore.toFixed(2) : "NA";

        const sliderIds = ["q1", "q2", "q3", "q4", "q5", "q6", "q7", "q8", "q9", "q10", "q11", "q12"];
        const naCheckboxIds = ["q1_na", "q2_na", "q3_na", "q4_na", "q5_na", "q6_na", "q7_na", "q8_na", "q9_na", "q10_na", "q11_na", "q12_na"];
    

        let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
        csvContent += "Sujet,Date,Score Total";
        sliderIds.forEach(q => {
          csvContent += `,${q}`;
        });
        csvContent += "\n";

        let row = `"${subjectCode}","${today}","${safeScore}"`;
        for (let i = 0; i < sliderIds.length; i++) {
          const slider = document.getElementById(sliderIds[i]);
          const naCheckbox = document.getElementById(naCheckboxIds[i]);
          let answer = naCheckbox.checked ? "NA" : slider.value;
          row += `,"${answer}"`;
        }

        csvContent += row + "\n";

        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }



    function savePdf() {
      const { jsPDF } = window.jspdf;
      const today = new Date().toLocaleDateString('fr-FR');
      const subjectCode = document.getElementById('ID').value || "SansNom";
      const filename = `SSQ12_${today}_${subjectCode}.pdf`;

      const safeScore = typeof globalScore === 'number' ? globalScore.toFixed(2) : "NA";

      const sliderIds = ["q1", "q2", "q3", "q4", "q5", "q6", "q7", "q8", "q9", "q10", "q11", "q12"];
      const naCheckboxIds = ["q1_na", "q2_na", "q3_na", "q4_na", "q5_na", "q6_na", "q7_na", "q8_na", "q9_na", "q10_na", "q11_na", "q12_na"];  

      let data2table = '';
      for (let i = 0; i < sliderIds.length; i++) {
          const answer = document.getElementById(naCheckboxIds[i])?.checked ? "Non applicable (NA)" : document.getElementById(sliderIds[i])?.value;
          data2table += `<p><strong>${sliderIds[i]}</strong>: ${answer || 'N/A'}</p>`;
      }

      const content = document.createElement('div');
      content.innerHTML = `
      <style>
          .header_report,
          .body_report,
          .footer_report {
              text-align: center;
              margin: 0 auto;
              width: 100%;
          }
          .header_report {
              padding-top: 4%;
              padding-bottom: 4%;
              background-color:white; /*color for test*/
              border-bottom: 1px solid #2B176C;
          }
          .footer_report {
              padding-top: 3%;
              padding-bottom:3%;
            
          }
          .body_report {
              padding-top: 5%;
              padding-bottom:80%;
              background-color: white;
              color: black; 
          }
      </style>
      <div class="header_report">
          <img src="https://data.memau.eu/wp-content/uploads/2025/06/logo-memau-data.svg" alt="Logo" style="max-width: 210px; 
          margin-top: 10px;margin-bottom: 5px;">
          <p><i>Contact : hello@memau.eu </i></p>
      </div>    
      <div class="body_report">
          <h1>SSQ12</h1>
          <p>Code du Sujet : ${subjectCode} </p>
          <p>Rapport généré le : ${today}</p>
          <p> Score total : ${safeScore} </p>
          <p> Score de chaque question</p>
          <p>${data2table}</p>
      </div>
    `;

    document.body.appendChild(content);

    // Use html2pdf to convert the HTML content to PDF
    const opt = {
        margin: [-200, 10, 10, 10], // Adjusted margin to ensure content is visible
        filename: filename,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    // Generate PDF from HTML content
    html2pdf().set(opt).from(content).save().then(() => {
        document.body.removeChild(content);
    });
}


function resetForm() {
      document.getElementById("SSQ12").reset();
      document.getElementById("DEMO").reset();
      document.getElementById('results').style.display = 'none';
      // Reset subject's name
      document.getElementById("ID").value = "";
      // Hide the save PDF button on reset
      document.getElementById('savePdfButton').style.display = 'none';
      document.getElementById('saveXLSbutton').style.display = 'none';


      // Réinitialise le fond des sliders
      const sliders = document.querySelectorAll(".slider");
      sliders.forEach(function (slider) {
      const initialValue = (slider.value - slider.min) / (slider.max - slider.min) * 100;
      slider.style.background = `linear-gradient(to right, #2B176C ${initialValue}%, #eeeeee ${initialValue}%)`;
                                                });
        } // end function


    </script>
  </body>

</html>