<!DOCTYPE html>
<html lang="fr">
  <head>
    <!-- Author's details-->
        <meta name="author" content="Nicolas Vannson">
        <meta name="contact" content="hello@memau.eu">
        <meta name="license" content="EUPLv1.2">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.0/jspdf.umd.min.js"></script>
        <script src= https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <link rel="stylesheet" href="/style.css">
        <style>
          /* style is within the style.css sheet */
        </style>
  <title>GBI</title>
  </head>
  <body>
    <h1>Glasgow Benefit Intervention (GBI)</h1>
    <p > Robinson et al., 1996 </p>
    <p > <b>Instructions : </b></p>
    <p >Quel est l’impact de votre <b>intervention</b> (chirurgie, prothèse(s) auditive(s)) sur votre vie actuelle?<br>
      Choisissez la réponse qui se rapproche le plus de votre expérience quotidienne.</p>
    <br>

    <form id="GBI">
        <table>
          <thead>
            <tr>
              <th></th>
              <th >Très nette amélioration</th>
              <th >Nette amélioration</th>
              <th >Pas de changement</th>
              <th>Légère déterioration</th>
              <th >Très forte déterioration</th> 
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="Question_GBI">1. Le résultat de l’intervention a-t-il affecté vos
                activités ? </td>
              <td><input type="radio" name="q1" value="5"></td>
              <td><input type="radio" name="q1" value="4"></td>
              <td><input type="radio" name="q1" value="3"></td>
              <td><input type="radio" name="q1" value="2"></td>
              <td><input type="radio" name="q1" value="1"></td>

            </tr>
            <tr>
              <td class="Question_GBI">2. Les résultats de l’intervention ont-ils rendu
                votre vie plus agréable ou plus désagréable ?</td>
              <td><input type="radio" name="q2" value="5"></td>
              <td><input type="radio" name="q2" value="4"></td>
              <td><input type="radio" name="q2" value="3"></td>
              <td><input type="radio" name="q2" value="2"></td>
              <td><input type="radio" name="q2" value="1"></td>
            </tr>
            <thead>
              <tr>
                <th ></th>
                <th >Beaucoup plus</th>
                <th >Plus</th>
                <th >Pas de changement</th>
                <th >Moins</th>
                <th >Beaucoup moins</th> 
              </tr>
            </thead>


            <tr>
              <td class="Question_GBI">3. Depuis votre intervention, vous sentez-vous plus (ou moins) optimiste face à l’avenir ? </td>
              <td><input type="radio" name="q3" value="5"></td>
              <td><input type="radio" name="q3" value="4"></td>
              <td><input type="radio" name="q3" value="3"></td>
              <td><input type="radio" name="q3" value="2"></td>
              <td><input type="radio" name="q3" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">4. Depuis votre intervention, vous sentez-vous plus (ou moins) gêné(e) lorsque vous vous trouvez en groupe?</td>
              <td><input type="radio" name="q4" value="1"></td>
              <td><input type="radio" name="q4" value="2"></td>
              <td><input type="radio" name="q4" value="3"></td>
              <td><input type="radio" name="q4" value="4"></td>
              <td><input type="radio" name="q4" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">5. Depuis votre opération, avez-vous plus (ou
                moins) de confiance en vous ? </td>
              <td><input type="radio" name="q5" value="5"></td>
              <td><input type="radio" name="q5" value="4"></td>
              <td><input type="radio" name="q5" value="3"></td>
              <td><input type="radio" name="q5" value="2"></td>
              <td><input type="radio" name="q5" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">6. Depuis votre intervention, vous est-il plus (ou
                moins) facile d’avoir affaire à d’autres
                personnes ?</td>
              <td><input type="radio" name="q6" value="5"></td>
              <td><input type="radio" name="q6" value="4"></td>
              <td><input type="radio" name="q6" value="3"></td>
              <td><input type="radio" name="q6" value="2"></td>
              <td><input type="radio" name="q6" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">7. Depuis votre intervention, avez-vous l’impression d’avoir plus (ou moins) de soutien de la part de vos amis ?</td>
              <td><input type="radio" name="q7" value="5"></td>
              <td><input type="radio" name="q7" value="4"></td>
              <td><input type="radio" name="q7" value="3"></td>
              <td><input type="radio" name="q7" value="2"></td>
              <td><input type="radio" name="q7" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">8. Depuis votre intervention, êtes-vous allé(e)
                trouver votre médecin de famille plus (ou moins)
                souvent ?</td>
              <td><input type="radio" name="q8" value="1"></td>
              <td><input type="radio" name="q8" value="2"></td>
              <td><input type="radio" name="q8" value="3"></td>
              <td><input type="radio" name="q8" value="4"></td>
              <td><input type="radio" name="q8" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">9. Depuis votre intervention, vous ressentez-vous
                plus (ou moins) de confiance face à des
                occasions d’emploi?</td>
              <td><input type="radio" name="q9" value="1"></td>
              <td><input type="radio" name="q9" value="2"></td>
              <td><input type="radio" name="q9" value="3"></td>
              <td><input type="radio" name="q9" value="4"></td>
              <td><input type="radio" name="q9" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">10. Depuis votre intervention, vous sentez-vous
                plus timide ou moins timide ? </td>
              <td><input type="radio" name="q10" value="1"></td>
              <td><input type="radio" name="q10" value="2"></td>
              <td><input type="radio" name="q10" value="3"></td>
              <td><input type="radio" name="q10" value="4"></td>
              <td><input type="radio" name="q10" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">11. Depuis votre intervention, y a-t-il davantage ou moins de gens qui s’occupent vraiment de vous ?</td>
              <td><input type="radio" name="q11" value="1"></td>
              <td><input type="radio" name="q11" value="2"></td>
              <td><input type="radio" name="q11" value="3"></td>
              <td><input type="radio" name="q11" value="4"></td>
              <td><input type="radio" name="q11" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">12. Depuis votre intervention, êtes-vous sujet(te) à des rhumes ou infections plus souvent ou moins souvent ?</td>
              <td><input type="radio" name="q12" value="1"></td>
              <td><input type="radio" name="q12" value="2"></td>
              <td><input type="radio" name="q12" value="3"></td>
              <td><input type="radio" name="q12" value="4"></td>
              <td><input type="radio" name="q12" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">13. Depuis votre intervention, devez-vous prendre
                plus (ou moins) de médicaments ?</td>
              <td><input type="radio" name="q13" value="1"></td>
              <td><input type="radio" name="q13" value="2"></td>
              <td><input type="radio" name="q13" value="3"></td>
              <td><input type="radio" name="q13" value="4"></td>
              <td><input type="radio" name="q13" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">14. Depuis votre intervention, vous sentez-vous
                plus (ou moins) en bonne santé? </td>
              <td><input type="radio" name="q14" value="5"></td>
              <td><input type="radio" name="q14" value="4"></td>
              <td><input type="radio" name="q14" value="3"></td>
              <td><input type="radio" name="q14" value="2"></td>
              <td><input type="radio" name="q14" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">15. Depuis votre opération, avez-vous l’impression d’avoir été plus soutenu(e) ou moins soutenu(e) par votre famille ?</td>
              <td><input type="radio" name="q15" value="5"></td>
              <td><input type="radio" name="q15" value="4"></td>
              <td><input type="radio" name="q15" value="3"></td>
              <td><input type="radio" name="q15" value="2"></td>
              <td><input type="radio" name="q15" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">16. Depuis votre intervention, êtes-vous plus (ou moins) gêné(e) par votre problème auditif ? </td>
              <td><input type="radio" name="q16" value="1"></td>
              <td><input type="radio" name="q16" value="2"></td>
              <td><input type="radio" name="q16" value="3"></td>
              <td><input type="radio" name="q16" value="4"></td>
              <td><input type="radio" name="q16" value="5"></td>
            </tr>
            <tr>
              <td class="Question_GBI">17. Depuis votre intervention, avez-vous pu participer à plus (ou moins) d’activités en société ?</td>
              <td><input type="radio" name="q17" value="5"></td>
              <td><input type="radio" name="q17" value="4"></td>
              <td><input type="radio" name="q17" value="3"></td>
              <td><input type="radio" name="q17" value="2"></td>
              <td><input type="radio" name="q17" value="1"></td>
            </tr>
            <tr>
              <td class="Question_GBI">18. Depuis votre intervention, avez-vous plus (ou moins) besoin de vous retrouver seul(e) ?</td>
              <td><input type="radio" name="q18" value="1"></td>
              <td><input type="radio" name="q18" value="2"></td>
              <td><input type="radio" name="q18" value="3"></td>
              <td><input type="radio" name="q18" value="4"></td>
              <td><input type="radio" name="q18" value="5"></td>
            </tr>

          </tbody>
        </table>
      <div class="buttons-container">
        <button type="button" onclick="calculateScore()">Calculer le Score</button>
        <button type="reset" onclick="resetForm()">Réinitialiser</button>
      </div>
    </form>
    <div id="results" style="display:none">
        <p id="scoreDisplay"></p><br>
        <label for="nameID" class="Subject_name">Nom du sujet (si besoin)</label>
        <input type="text" id="ID" name="nameID"><br>
        <button id="savePdfButton" onclick="savePdf()">Exporter en PDF</button>
        <button id="saveXLSbutton" onclick="saveXLS()">Exporter en XLS</button>
      </div>
    <script>
        // This function is responsible for calculating the GBI and subscale scores.
        function calculateScore() {
        let totalScore = 0;
        let answeredQuestions = 0;

        // Define questions for each subscale
        const generalBenefitQuestions = ['q1', 'q2', 'q3', 'q5', 'q6', 'q7', 'q14', 'q15', 'q17'];
        let generalBenefitScore = 0;
        let generalBenefitAnswered = 0;

        const socialSupportQuestions = ['q4', 'q10', 'q11', 'q18'];
        let socialSupportScore = 0;
        let socialSupportAnswered = 0;

        const physicalHealthQuestions = ['q8', 'q9', 'q12', 'q13', 'q16'];
        let physicalHealthScore = 0;
        let physicalHealthAnswered = 0;

        // Loop through all 18 questions to collect scores
        for (let i = 1; i <= 18; i++) {
          const qName = 'q' + i;
          const selectedOption = document.querySelector(`input[name="${qName}"]:checked`);

          if (selectedOption) {
            const value = parseInt(selectedOption.value);
            totalScore += value;
            answeredQuestions++;

            // Assign scores to respective subscales
            if (generalBenefitQuestions.includes(qName)) {
              generalBenefitScore += value;
              generalBenefitAnswered++;
            } else if (socialSupportQuestions.includes(qName)) {
              socialSupportScore += value;
              socialSupportAnswered++;
            } else if (physicalHealthQuestions.includes(qName)) {
              physicalHealthScore += value;
              physicalHealthAnswered++;
            }
          }
        }

        // Handle cases where not all questions are answered for a subscale
        if (answeredQuestions < 18) {
          const resultDiv = document.getElementById("results"); // Assuming you have a div with id="result"
          resultDiv.innerHTML = "<p class=Error_message_not_all_answered>Veuillez répondre svp à toutes les questions avant de calculer le score!</p>";
          resultDiv.style.display = "block"; // Make sure the result div is visible
        return; // Exit if no questions are answered
        }


        // --- Score Calculation ---
        // The GBI uses a specific normalization.
        // Each question score (1-5) is normalized around 0 (3 = 0, 5 = +2, 1 = -2).
        // Then, the normalized sum is divided by the maximum possible positive sum
        // (number of questions * 2, since max positive for one question is 2),
        // and multiplied by 100 to scale to a -100 to +100 range.

        const calculateSubscaleScore = (scoreSum, answeredCount) => {
          if (answeredCount === 0) {
            return 0; // Avoid division by zero if no questions were answered for this subscale
          }
          const normalizedSum = scoreSum - (3 * answeredCount);
          return (normalizedSum / (2 * answeredCount)) * 100;
        };

        const gbiScore = calculateSubscaleScore(totalScore, answeredQuestions);
        const generalBenefitSubscale = calculateSubscaleScore(generalBenefitScore, generalBenefitAnswered);
        const socialSupportSubscale = calculateSubscaleScore(socialSupportScore, socialSupportAnswered);
        const physicalHealthSubscale = calculateSubscaleScore(physicalHealthScore, physicalHealthAnswered);

        // Display the calculated scores
        displayResults(gbiScore, generalBenefitSubscale, socialSupportSubscale, physicalHealthSubscale);
      }

      // This function is purely for displaying the scores in the designated HTML element.
      function displayResults(gbiScore, generalBenefitSubscale, socialSupportSubscale, physicalHealthSubscale) {
        let display = "<p>Résultats</p>";
        display += "<br>";
        display += "<ul class='myList'>";
        display += "<li>Score Total GBI : " + gbiScore.toFixed(2) + "</li>";
        display += "<li>Bénéfice Général : " + generalBenefitSubscale.toFixed(2) + "</li>";
        display += "<li>Soutien Social : " + socialSupportSubscale.toFixed(2) + "</li>";
        display += "<li>Santé Physique : " + physicalHealthSubscale.toFixed(2) + "</li>";
        display += "</ul>";
        display += "<p> Les scores vont de -100 (bénéfices négatifs) à +100 (bénéfices positifs). </p>";

        document.getElementById("results").innerHTML = display;
        document.getElementById("results").style.display = "block";
      }

      // This function resets the form and clears the displayed results.
      function resetForm() {
        document.getElementById("GBI").reset(); // Assuming 'gbi' is the ID of your form
        document.getElementById("results").innerHTML = "";
        document.getElementById("results").style.display = "none"; // Hide the result div
      }
    </script>
  </body>
</html>
