<!DOCTYPE html>
<html lang="fr">
  <head>
    <!-- Author's details-->
        <meta name="author" content="Nicolas Vannson">
        <meta name="contact" content="hello@memau.eu">
        <meta name="license" content="EUPLv1.2">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.0/jspdf.umd.min.js"></script>
        <script src= https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <link rel="stylesheet" href="/style.css">
        <style>
          /* style is within the style.css sheet */
        </style>
    <title>GHSI</title>
  </head>
  <body>

    <h1>Glasgow Health Status Inventory (GHSI)</h1>
    <p> MRC Institute of Hearing Research, 1998</p>
    <br>

    <form id="GHSI">
      <table>
        <tbody>
          <tr >
            <td class="Question_GHSI">1. Votre surdité affecte-t-elle souvent vos activités ?</td>
          </tr>
          <tr>
            <td class="Answer_GHSI">
              <label>Fréquemment ou tout le temps <br> <input type="radio" name="q1" value="1"></label>
              <label>La moitié du temps <br><input type="radio" name="q1" value="2"></label>
              <label>Parfois <br><input type="radio" name="q1" value="3"></label>
              <label>Rarement <br><input type="radio" name="q1" value="4"></label>
              <label>Jamais <br><input type="radio" name="q1" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">2. Dans quelle mesure votre surdité affecte-t-elle votre vie en général ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Pas du tout <br><input type="radio" name="q2" value="5"></label>
              <label>Très peu <br><input type="radio" name="q2" value="4"></label>
              <label>Un peu <br><input type="radio" name="q2" value="3"></label>
              <label>Moyennement <br><input type="radio" name="q2" value="2"></label>
              <label>Beaucoup <br><input type="radio" name="q2" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">3. Parmi les propositions suivantes, laquelle décrit le mieux votre attitude face à l'avenir?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Optimiste <br><input type="radio" name="q3" value="5"></label>
              <label>Assez optimiste <br><input type="radio" name="q3" value="4"></label>
              <label>Ne sait pas <br><input type="radio" name="q3" value="3"></label>
              <label>Assez pessimiste <br><input type="radio" name="q3" value="2"></label>
              <label>Pessimiste <br><input type="radio" name="q3" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">4. En raison de votre surdité, vous sentez-vous souvent gêné(e) dans un groupe de gens?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Fréquemment ou tout le temps <br><input type="radio" name="q4" value="1"></label>
              <label>La moitié du temps <br><input type="radio" name="q4" value="2"></label>
              <label>Parfois <br><input type="radio" name="q4" value="3"></label>
              <label>Rarement <br><input type="radio" name="q4" value="4"></label>
              <label>Jamais <br><input type="radio" name="q4" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">5. Votre confiance en vous est-elle affectée par votre surdité ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Pas du tout <br><input type="radio" name="q5" value="5"></label>
              <label>Très peu <br><input type="radio" name="q5" value="4"></label>
              <label>Un peu <br><input type="radio" name="q5" value="3"></label>
              <label>Moyennement <br><input type="radio" name="q5" value="2"></label>
              <label>Beaucoup <br><input type="radio" name="q5" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">6. Les difficultés liées à votre surdité affectent-elles souvent vos rapports avec les autres ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Jamais <br><input type="radio" name="q6" value="5"></label>
              <label>Rarement <br><input type="radio" name="q6" value="4"></label>
              <label>Parfois <br><input type="radio" name="q6" value="3"></label>
              <label>Fréquemment <br><input type="radio" name="q6" value="2"></label>
              <label>Tout le temps <br><input type="radio" name="q6" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">7. Êtes-vous soutenu(e) par vos amis ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Extrêmement soutenu(e) <br><input type="radio" name="q7" value="5"></label>
              <label>Très soutenu(e) <br><input type="radio" name="q7" value="4"></label>
              <label>Assez soutenu(e) <br><input type="radio" name="q7" value="3"></label>
              <label>Un peu soutenu(e) <br><input type="radio" name="q7" value="2"></label>
              <label>Très peu ou pas du tout <br><input type="radio" name="q7" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">8. Consultez-vous souvent votre médecin de famille pour une raison ou pour une autre ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Au moins sept fois par an <br><input type="radio" name="q8" value="1"></label>
              <label>Cinq ou six fois par an <br><input type="radio" name="q8" value="2"></label>
              <label>Trois ou quatre fois par an <br><input type="radio" name="q8" value="3"></label>
              <label>Une ou deux fois par an <br><input type="radio" name="q8" value="4"></label>
              <label>Jamais <br><input type="radio" name="q8" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">9. Les difficultés liées à votre surdité affectent-elles souvent la façon dont vous considérez vos possibilités d'emploi ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Jamais <br><input type="radio" name="q9" value="5"></label>
              <label>Rarement <br><input type="radio" name="q9" value="4"></label>
              <label>Parfois <br><input type="radio" name="q9" value="3"></label>
              <label>Fréquemment <br><input type="radio" name="q9" value="2"></label>
              <label>Tout le temps <br><input type="radio" name="q9" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">10. Les difficultés liées à votre surdité vous rendent-elles souvent timide ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Fréquemment ou tout le temps <br><input type="radio" name="q10" value="1"></label>
              <label>La moitié du temps <br><input type="radio" name="q10" value="2"></label>
              <label>Parfois <br><input type="radio" name="q10" value="3"></label>
              <label>Rarement <br><input type="radio" name="q10" value="4"></label>
              <label>Jamais <br><input type="radio" name="q10" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">11. Combien de personnes s'occupent vraiment de vous ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Plus de six personnes <br><input type="radio" name="q11" value="1"></label>
              <label>Cinq ou six personnes <br><input type="radio" name="q11" value="2"></label>
              <label>Trois ou quatre personnes <br><input type="radio" name="q11" value="3"></label>
              <label>Une ou deux personnes <br><input type="radio" name="q11" value="4"></label>
              <label>Aucune <br><input type="radio" name="q11" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">12. Si un rhume ou une infection circule, l'attrapez-vous souvent ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Fréquemment ou tout le temps <br><input type="radio" name="q12" value="1"></label>
              <label>La moitié du temps <br><input type="radio" name="q12" value="2"></label>
              <label>Parfois <br><input type="radio" name="q12" value="3"></label>
              <label>Rarement <br><input type="radio" name="q12" value="4"></label>
              <label>Jamais <br><input type="radio" name="q12" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">13. Devez-vous souvent prendre des médicaments pour une raison ou pour une autre ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Fréquemment ou tout le temps <br><input type="radio" name="q13" value="1"></label>
              <label>La moitié du temps <br><input type="radio" name="q13" value="2"></label>
              <label>Parfois <br><input type="radio" name="q13" value="3"></label>
              <label>Rarement <br><input type="radio" name="q13" value="4"></label>
              <label>Jamais <br><input type="radio" name="q13" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">14. Les difficultés liées à votre surdité ont-elles un effet sur la façon dont vous vous considérez?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Aucun effet <br><input type="radio" name="q14" value="5"></label>
              <label>Très peu d'effet <br><input type="radio" name="q14" value="4"></label>
              <label>Peu d'effet <br><input type="radio" name="q14" value="3"></label>
              <label>Un peu d'effet <br><input type="radio" name="q14" value="2"></label>
              <label>Beaucoup d'effet <br><input type="radio" name="q14" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">15. Êtes-vous soutenu(e) par votre famille ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Extrêmement soutenu(e) <br><input type="radio" name="q15" value="5"></label>
              <label>Très soutenu(e) <br><input type="radio" name="q15" value="4"></label>
              <label>Assez soutenu(e) <br><input type="radio" name="q15" value="3"></label>
              <label>Un peu soutenu(e) <br><input type="radio" name="q15" value="2"></label>
              <label>Très peu ou pas du tout soutenu(e) <br><input type="radio" name="q15" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">16. Êtes-vous souvent gêné(e) par votre surdité ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Tous les jours <br><input type="radio" name="q16" value="1"></label>
              <label>Une ou deux dois par semaine <br><input type="radio" name="q16" value="2"></label>
              <label>Une ou deux fois par mois <br><input type="radio" name="q16" value="3"></label>
              <label>Moins de 6 fois par an <br><input type="radio" name="q16" value="4"></label>
              <label>Jamais <br><input type="radio" name="q16" value="5"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">17. Participez-vous souvent à des activités en société ?</td>
          </tr>
           <tr>
            <td class="Answer_GHSI">
              <label>Plus de trois fois par jour <br><input type="radio" name="q17" value="5"></label>
              <label>Une ou deux fois par jour <br><input type="radio" name="q17" value="4"></label>
              <label>Une ou deux fois par semaine <br><input type="radio" name="q17" value="3"></label>
              <label>Une ou deux fois par mois <br><input type="radio" name="q17" value="2"></label>
              <label>Moins de 1 fois par mois <br><input type="radio" name="q17" value="1"></label>
            </td>
          </tr>
           <tr>
            <td class="Question_GHSI">18. Ressentez-vous souvent le besoin de vous retrouver seul(e)?</td>
          </tr>
          <tr>
            <td class="Answer_GHSI">
              <label>Fréquemment ou tout le temps <br><input type="radio" name="q18" value="1"></label>
              <label>La moitié du temps <br><input type="radio" name="q18" value="2"></label>
              <label>Parfois <br><input type="radio" name="q18" value="3"></label>
              <label>Rarement <br><input type="radio" name="q18" value="4"></label>
              <label>Jamais <br><input type="radio" name="q18" value="5"></label>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="buttons-container">
        <button type="button" onclick="calculateScore()">Calculer le score</button>
        <button type="reset" onclick="resetForm()">Réinitialiser</button>
      </div>

    </form>

    <div id="results" style="display:none">
      <p id="scoreDisplay"></p><br>
      <label for="nameID" class="Subject_name">Nom du sujet (si besoin)</label>
      <input type="text" id="ID" name="nameID"><br>
      <button id="savePdfButton" onclick="savePdf()">Exporter en PDF</button>
      <button id="saveXLSbutton" onclick="saveXLS()">Exporter en XLS</button>
    </div>


    <script>

    const GHSI = {
          TOTAL: null,
          GEN: null,
          SOCIAL: null,
          PHYSICAL: null
        };


      function calculateScore() {
        let total = 0;
        let general = 0;
        let social = 0;
        let physical = 0;
        const numQuestions = 18;
        let allQuestionsAnswered = true;
        let answeredQuestions = 0;

        for (let i = 1; i <= numQuestions; i++) {
          const questionName = `q${i}`;
          const selectedOption = document.querySelector(`input[name="${questionName}"]:checked`);

          if (selectedOption) {
            const value = parseInt(selectedOption.value);
            total += value;
            answeredQuestions++;

            // Categorization logic as provided, fixing syntax for general category
            if ([1, 2, 3, 4, 5, 6, 9, 10, 14, 16, 17, 18].includes(i)) {
              general += value;
            } else if ([7, 11, 15].includes(i)) {
              social += value;
            } else if ([8, 12, 13].includes(i)) { 

              physical += value;
            }
          } else {
            allQuestionsAnswered = false;
            break; // Exit loop if any question is unanswered
          }
        }

        
        // Handle cases where not all questions are answered for a subscale
        if (answeredQuestions < 18) {
          const resultDiv = document.getElementById("results");
          resultDiv.innerHTML = "<p class=Error_message_not_all_answered>Veuillez répondre svp à toutes les questions avant de calculer le score!</p>";
          resultDiv.style.display = "block"; 
          return;
        }
        
        total = ((total / 18) - 1) * 25;
        general = ((general / 12) - 1) * 25; 
        social = ((social / 3) - 1) * 25; 
        physical = ((physical / 3) - 1) * 25; 

        

        // Update global variables
        GHSI.TOTAL =total;
        GHSI.GEN =general;
        GHSI.SOCIAL =social;
        GHSI.PHYSICAL =physical;

        //display scores
        display(total, general, social, physical);


      } // end calculateScore function

      function display(total, general, social, physical) {
       
        let display = "<p>Résultats</p>";
        display += "<br>";
        display += "<ul class='myList'>";
        display += "<li>Le score total  : " + total.toFixed(2) + "</li>";
        display += "<li>Score Général : " + general.toFixed(2) + "</li>";
        display += "<li>Score Social : " + social.toFixed(2) + "</li>";
        display += "<li>Score Physique : " + physical.toFixed(2) + "</li>";
        display += "</ul>";
        display += "<p>Tous les scores sont compris entre 0 et +100.</p>" ;
        display += "<p>Le score de 0 reflète un très mauvais état de santé et 100 un excellent";

        document.getElementById("scoreDisplay").innerHTML = display;
        document.getElementById("results").style.display = "block";
        document.getElementById('savePdfButton').style.display = 'inline-block';
        document.getElementById('saveXLSbutton').style.display = 'inline-block';
        document.getElementById("ID").style.display = 'inline-block';
        document.getElementById("labelId").style.display = 'inline-block';


      } // end display function

      function resetForm() {
        document.getElementById("GHSI").reset();
        document.getElementById("ID").value = ""; 
        document.getElementById("results").innerHTML = "";
        document.getElementById("results").style.display = "none";
      } // end resetForm function


      function saveXLS() {

        const subjectCode = document.getElementById('ID').value || "SansNom";
        const today = new Date().toLocaleDateString('fr-FR');
        const filename = `GHSI_${today}_${subjectCode}.csv`;

        // Récupérer les réponses
        let answers = [];
        for (let i = 1; i <= 18; i++) {
            const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
            answers.push(selectedOption ? selectedOption.value : "NA");
        }


        // Calculer les scores
        const safeTotal = typeof GHSI.TOTAL === 'number' ? GHSI.TOTAL.toFixed(2) : "NA";
        const safeGeneral = typeof GHSI.GEN === 'number' ?  GHSI.GEN.toFixed(2) : "NA";
        const safeSocial = typeof GHSI.SOCIAL === 'number' ? GHSI.SOCIAL.toFixed(2) : "NA";
        const safePhysique = typeof GHSI.PHYSICAL === 'number' ? GHSI.PHYSICAL.toFixed(2) : "NA";


        // Créer le contenu CSV
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
        csvContent += "Sujet,Date,Questionnaire,Total,General,Social,Physique,";
        for (let i = 1; i <= 18; i++) {
            csvContent += `Q${i},`;
        }
        csvContent += "\n";
        let row = `"${subjectCode}","${today}","GHSI","${safeTotal}","${safeGeneral}","${safeSocial}","${safePhysique}",`;
        row += answers.join(",");
        csvContent += row + "\n";

        // Télécharger le fichier
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        }

        function savePdf() {

          const { jsPDF } = window.jspdf;
          const today = new Date().toLocaleDateString('fr-FR');
          const subjectCode = document.getElementById('ID').value || "SansNom";
          const filename = `GHSI_${today}_${subjectCode}.pdf`;


          // Calculer les scores
          const safeTotal = typeof GHSI.TOTAL === 'number' ? GHSI.TOTAL.toFixed(2) : "NA";
          const safeGeneral = typeof GHSI.GEN === 'number' ?  GHSI.GEN.toFixed(2) : "NA";
          const safeSocial = typeof GHSI.SOCIAL === 'number' ? GHSI.SOCIAL.toFixed(2) : "NA";
          const safePhysique = typeof GHSI.PHYSICAL === 'number' ? GHSI.PHYSICAL.toFixed(2) : "NA";


          let data2table = "<table>";
          let answers = [];

          for (let i = 1; i <= 18; i++) {
            const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
            const answer = selectedOption ? selectedOption.value : "NA";
            answers.push(answer);

            // Ouvrir une ligne toutes les deux questions
            if (i % 2 === 1) {
              data2table += "<tr>";
            }

            data2table += `<td>Q${i} : ${answer}</td>`;

            // Fermer la ligne après deux colonnes ou à la dernière question
            if (i % 2 === 0 || i === 18) {
              data2table += "</tr>";
            }
          }

          data2table += "</table>";


          const content = document.createElement('div');
          content.innerHTML = `
            <style>
            @page {
                size: A4;
                margin: 0;
              }  
            .header_report,
            .body_report,
            .footer_report {
            text-align: center;
            margin: 0 auto;
            width: 100%;
            }
            .header_report {
            padding-top: 4%;
            padding-bottom: 4%;
            background-color:white; /*color for test*/
            border-bottom: 1px solid #2B176C;
            }
            .footer_report {
            padding-top: 3%;
            padding-bottom:3%;

            }
            .body_report {
            padding-top: 5%;
            padding-bottom:20%;
            background-color: white;
            color: black; 
            }


            table {
              border-collapse: collapse;
              width: 80%;
              margin-top: 20px;
              margin: 0 auto;
            }

            th, td {
              padding: 6px 12px;
              border: 1px solid #eeeeee;
          }
            td strong {
              display: block;
              text-align: left;
            }


            </style>
            <div class="header_report">
            <img src="https://data.memau.eu/wp-content/uploads/2025/06/logo-memau-data.svg" alt="Logo" style="max-width: 210px; 
            margin-top: 10px;margin-bottom: 5px;">
            <p><i>Contact : hello@memau.eu </i></p>
                  </div>    
            <div class="body_report">
              <h1>GHSI</h1>
              <p>Code du Sujet : ${subjectCode} </p>
              <p>Rapport généré le : ${today}</p>
              <p>Score total :&nbsp;${safeTotal}</p>
              <p>Bénéfice Général :&nbsp;${safeGeneral}</p>
              <p>Soutien Social :&nbsp;${safeSocial}</p>
              <p>Santé Physique :&nbsp;${safePhysique}</p>
              <p>Score brut de chaque question</p>

              <div class="data2columns">
                ${data2table}
              </div>
            </div>
            `;



            document.body.appendChild(content);

            // Use html2pdf to convert the HTML content to PDF
            const opt = {
              margin: [10, 10, 10, 10], // Adjusted margin to ensure content is visible
              filename: filename,
              image: { type: 'jpeg', quality: 0.98 },
              html2canvas: { scale: 2, useCORS: true,scrollY: 0 },
              jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Generate PDF from HTML content
            html2pdf().set(opt).from(content).save().then(() => {
              document.body.removeChild(content);
            });
          }

    </script>

  </body>
</html>