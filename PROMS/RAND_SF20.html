<!DOCTYPE html>
<html lang="fr">
  <head>
    <!-- Author's details-->
        <meta name="author" content="Nicolas Vannson">
        <meta name="contact" content="hello@memau.eu">
        <meta name="license" content="EUPLv1.2">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.0/jspdf.umd.min.js"></script>
        <script src= https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <link rel="stylesheet" href="/style.css">
        <style>
          /* style is within the style.css sheet */
        </style>
    <title>SF20</title>
  </head>
  <body>
    <h1>Questionnaire d'état de santé SF20 version 1.0<br>
    développé par RAND (ou RAND-SF20)</h1>
    <p>Stewart et al., 1988 (version originale)</p>
    <p> La version de ce questionnaire est une version publique accordée par <a href= "https://www.rand.org/health-care/surveys_tools/mos/36-item-short-form.html"> RAND.</a> </p>
     
    <p><b>COMMENT REPONDRE</b></p>
    <p>Les questions, qui suivent, portent sur votre état de santé tel que vous le ressentez. Ces informations nous permettront de mieux savoir comment vous vous sentez dans la vie de tous les jours. <b>Veuillez répondre à toutes les questions</b> en cochant la case correspondant à la réponse choisie. Si vous ne savez pas très bien comment répondre, choisissez la réponse la plus adaptée à votre situation.</p>
    <br>

    <form id="SF20">
      <table>
          <tr>
            <th colspan="5" class="Question_SF36">
              1. Dans l'ensemble, pensez-vous que votre santé est :
            </th>
          </tr>
          <tr>
            <td><label><input type="radio" name="q1" value="100"> Excellente</label></td>
            <td><label><input type="radio" name="q1" value="75"> Très bonne</label></td>
            <td><label><input type="radio" name="q1" value="50"> Bonne</label></td>
            <td><label><input type="radio" name="q1" value="25"> Médiocre</label></td>
            <td><label><input type="radio" name="q1" value="0"> Mauvaise</label></td>
          </tr>
        </tbody>
      </table>

      <table>
          <tr>
            <th colspan="4" class="Question_SF36">
              2. Voici une liste d'activités que vous pouvez avoir à faire dans votre vie de tous les jours. Pour chacune d'entre elles indiquez si vous êtes limité(e) en raison de votre état de santé actuel.
            </th>
          </tr>
          <tr>
            <th class="Question_SF36" >Listes d'activités</th>
            <th>Oui, depuis<br> plus de 3 mois</th>
            <th>Oui, depuis<br> moins de 3 mois</th>
            <th >Non</th>
          </tr>
          <tr>
            <td class="Question_SF36">a. Efforts physiques importants tels que courir, soulever un objet lourd, faire du sport</td>
            <td><label><input type="radio" name="q2a" value="0"></label></td>
            <td><label><input type="radio" name="q2a" value="50"></label></td>
            <td><label><input type="radio" name="q2a" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">b. Efforts physiques modérés tels que déplacer une table, passer l'aspirateur, jouer aux boules</td>
            <td><label><input type="radio" name="q2b" value="0"></label></td>
            <td><label><input type="radio" name="q2b" value="50"></label></td>
            <td><label><input type="radio" name="q2b" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">c. Monter plusieurs étages par l'escalier</td>
            <td><label><input type="radio" name="q2c" value="0"></label></td>
            <td><label><input type="radio" name="q2c" value="50"></label></td>
            <td><label><input type="radio" name="q2c" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">d. Se pencher en avant, se mettre à genoux, s'accroupir</td>
            <td><label><input type="radio" name="q2d" value="0"></label></td>
            <td><label><input type="radio" name="q2d" value="50"></label></td>
            <td><label><input type="radio" name="q2d" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">e. Marcher une centaine de mètres</td>
            <td><label><input type="radio" name="q2e" value="0"></label></td>
            <td><label><input type="radio" name="q2e" value="50"></label></td>
            <td><label><input type="radio" name="q2e" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">f. Prendre un bain, une douche ou s'habiller</td>
            <td><label><input type="radio" name="q2f" value="0"></label></td>
            <td><label><input type="radio" name="q2f" value="50"></label></td>
            <td><label><input type="radio" name="q2f" value="100"></label></td>
          </tr>
      </table>

      <table>
          <tr>
            <th colspan="6" class="Question_SF36">
              3. Au cours de ces 4 dernières semaines, quelle a été l'intensité de vos douleurs physiques ?
            </th>
          </tr>
          <tr>
            <td><label><input type="radio" name="q3" value="100"> Nulle</label></td>
            <td><label><input type="radio" name="q3" value="80"> Très faible</label></td>
            <td><label><input type="radio" name="q3" value="60"> Faible</label></td>
            <td><label><input type="radio" name="q3" value="40"> Moyenne</label></td>
            <td><label><input type="radio" name="q3" value="20"> Grande</label></td>
            <td><label><input type="radio" name="q3" value="0"> Très grande</label></td>
          </tr>
      </table>

      <table>
          <tr>
            <th colspan="3" class="Question_SF36">
              4. En raison de votre état de santé, avez-vous réduit le temps passé à votre travail ou à vos activités habituelles ?
            </th>
          </tr>
          <tr>
            <td ><label><input type="radio" name="q4" value="0"> Oui depuis plus de 3 mois</label></td>
            <td><label><input type="radio" name="q4" value="50"> Oui depuis moins de 3 mois</label></td>
            <td><label><input type="radio" name="q4" value="100"> Non</label></td>
          </tr>
      </table>

      <table>
          <tr>
            <th colspan="3" class="Question_SF36">
              5. En raison de votre état de santé, Avez-vous eu des difficultés à faire votre travail ou toute autre activité ?
            </th>
          </tr>
          <tr>
            <td><label><input type="radio" name="q5" value="0"> Oui depuis plus de 3 mois</label></td>
            <td><label><input type="radio" name="q5" value="50"> Oui depuis moins de 3 mois</label></td>
            <td><label><input type="radio" name="q5" value="100"> Non</label></td>
          </tr>
      </table>

      <table>
          <tr>
            <th colspan="7" class="Question_SF36">
              6. Pour chaque question, veuillez indiquer la réponse qui vous semble la plus appropriée. Au cours de ces 4 dernières semaines, y a-t-il eu des moments où :
            </th>
          </tr>
          <tr>
            <th></th>
            <th >En permanence</th>
            <th >Très souvent</th>
            <th >Souvent</th>
            <th >Quelquefois</th>
            <th >Rarement</th>
            <th >Jamais</th>
          </tr>
          <tr>
            <td class="Question_SF36">a. Votre état de santé, vous a gêné(e) dans votre vie sociale et vos relations avec les autres, votre famille, vos amis, vos connaissances?</td>
            <td><label><input type="radio" name="q6a" value="0"></label></td>
            <td><label><input type="radio" name="q6a" value="20"></label></td>
            <td><label><input type="radio" name="q6a" value="40"></label></td>
            <td><label><input type="radio" name="q6a" value="60"></label></td>
            <td><label><input type="radio" name="q6a" value="80"></label></td>
            <td><label><input type="radio" name="q6a" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">b. Vous vous êtes senti(e) très nerveux (se)?</td>
            <td><label><input type="radio" name="q6b" value="0"></label></td>
            <td><label><input type="radio" name="q6b" value="20"></label></td>
            <td><label><input type="radio" name="q6b" value="40"></label></td>
            <td><label><input type="radio" name="q6b" value="60"></label></td>
            <td><label><input type="radio" name="q6b" value="80"></label></td>
            <td><label><input type="radio" name="q6b" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">c. Vous vous êtes senti(e) calme et détendu(e)?</td>
            <td><label><input type="radio" name="q6c" value="100"></label></td>
            <td><label><input type="radio" name="q6c" value="80"></label></td>
            <td><label><input type="radio" name="q6c" value="60"></label></td>
            <td><label><input type="radio" name="q6c" value="40"></label></td>
            <td><label><input type="radio" name="q6c" value="20"></label></td>
            <td><label><input type="radio" name="q6c" value="0"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">d. Vous vous êtes senti(e) triste et abattu(e)?</td>
            <td><label><input type="radio" name="q6d" value="0"></label></td>
            <td><label><input type="radio" name="q6d" value="20"></label></td>
            <td><label><input type="radio" name="q6d" value="40"></label></td>
            <td><label><input type="radio" name="q6d" value="60"></label></td>
            <td><label><input type="radio" name="q6d" value="80"></label></td>
            <td><label><input type="radio" name="q6d" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">e. Vous vous êtes senti(e) heureux (se)?</td>
            <td><label><input type="radio" name="q6e" value="100"></label></td>
            <td><label><input type="radio" name="q6e" value="80"></label></td>
            <td><label><input type="radio" name="q6e" value="60"></label></td>
            <td><label><input type="radio" name="q6e" value="40"></label></td>
            <td><label><input type="radio" name="q6e" value="20"></label></td>
            <td><label><input type="radio" name="q6e" value="0"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">f. Vous vous êtes senti(e) si découragé(e) que rien ne pouvait vous remonter le moral?</td>
            <td><label><input type="radio" name="q6f" value="0"></label></td>
            <td><label><input type="radio" name="q6f" value="20"></label></td>
            <td><label><input type="radio" name="q6f" value="40"></label></td>
            <td><label><input type="radio" name="q6f" value="60"></label></td>
            <td><label><input type="radio" name="q6f" value="80"></label></td>
            <td><label><input type="radio" name="q6f" value="100"></label></td>
          </tr>
      </table>

      <table>
        <thead>
          <tr>
            <th colspan="6" class="Question_SF36">
              7. Indiquez, pour chacune des phrases suivantes, dans quelle mesure elles sont vraies ou fausses dans votre cas:
            </th>
          </tr>
          <tr>
            <th></th>
            <th>Totalement vrai</th>
            <th >Plutôt vrai</th>
            <th >Je ne sais pas</th>
            <th >Plutôt faux</th>
            <th >Totalement faux</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="Question_SF36">a. Je tombe plus facilement malade que les autres</td>
            <td><label><input type="radio" name="q7a" value="0"></label></td>
            <td><label><input type="radio" name="q7a" value="25"></label></td>
            <td><label><input type="radio" name="q7a" value="50"></label></td>
            <td><label><input type="radio" name="q7a" value="75"></label></td>
            <td><label><input type="radio" name="q7a" value="100"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">b. Je me porte aussi bien que n'importe qui</td>
            <td><label><input type="radio" name="q7b" value="100"></label></td>
            <td><label><input type="radio" name="q7b" value="75"></label></td>
            <td><label><input type="radio" name="q7b" value="50"></label></td>
            <td><label><input type="radio" name="q7b" value="25"></label></td>
            <td><label><input type="radio" name="q7b" value="0"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">c. Je suis en excellente santé</td>
            <td><label><input type="radio" name="q7c" value="100"></label></td>
            <td><label><input type="radio" name="q7c" value="75"></label></td>
            <td><label><input type="radio" name="q7c" value="50"></label></td>
            <td><label><input type="radio" name="q7c" value="25"></label></td>
            <td><label><input type="radio" name="q7c" value="0"></label></td>
          </tr>
          <tr>
            <td class="Question_SF36">d. Je m'attends à ce que ma santé se dégrade</td>
            <td><label><input type="radio" name="q7d" value="0"></label></td>
            <td><label><input type="radio" name="q7d" value="25"></label></td>
            <td><label><input type="radio" name="q7d" value="50"></label></td>
            <td><label><input type="radio" name="q7d" value="75"></label></td>
            <td><label><input type="radio" name="q7d" value="100"></label></td>
          </tr>
        </tbody>
      </table>

      <div class="buttons-container">
        <button type="button" onclick="calculateScore()">Calculer le score</button>
        <button type="reset" onclick="resetForm()">Réinitialiser</button>
      </div>

      <div id="results" style="display:none">
          <p id="scoreDisplay"></p><br>
          <label id ="labelId" for="nameID" class="Subject_name">Nom du sujet (si besoin)</label>
          <input type="text" id="ID" name="nameID"><br>
          <button id="savePdfButton" onclick="savePdf()">Exporter en PDF</button>
          <button id="saveXLSbutton" onclick="saveXLS()">Exporter en XLS</button>
      </div>

    </form>

    <script>

      const SF20 = {

        globalPF : null,
        globalBP : null,
        globalRP : null,
        globalSF : null,
        globalMH : null,
        globalHT : null

      };

              
      function calculateScore() {
        const form = document.getElementById('SF20');
        let answeredQuestionsCount = 0;
        const totalQuestions = 20; 

        const getRadioValue = (name) => {
          const radios = form.elements[name];
          if (radios) {
            for (let i = 0; i < radios.length; i++) {
              if (radios[i].checked) {
                answeredQuestionsCount++;
                return parseInt(radios[i].value);
              }
            }
          }
          return NaN; 
        };

   
        //Get scores
        let scoreQ1 = getRadioValue('q1');
        let scoreQ2 = 0;
        for (let i = 0; i < 6; i++) {
                const charCode = 'a'.charCodeAt(0) + i;
                const q2Val = getRadioValue(`q2${String.fromCharCode(charCode)}`);
                scoreQ2 += q2Val;
            }

        let scoreQ3   = getRadioValue('q3');
        let scoreQ4   = getRadioValue('q4');
        let scoreQ5   = getRadioValue('q5');
        let scoreQ6_a = getRadioValue('q6a');
        let scoreQ6_b = getRadioValue('q6b');
        let scoreQ6_c = getRadioValue('q6c');
        let scoreQ6_d = getRadioValue('q6d');
        let scoreQ6_e = getRadioValue('q6e');
        let scoreQ6_f = getRadioValue('q6f');

   
        let scoreQ7 = 0;
        for (let i = 0; i < 4; i++) {
          const charCode = 'a'.charCodeAt(0) + i;
          const q7Val = getRadioValue(`q7${String.fromCharCode(charCode)}`);
          scoreQ7 += q7Val;
        }

        if (answeredQuestionsCount <20) {

          let errormsg = "<p class=Error_message_not_all_answered>Veuillez répondre svp à toutes les questions avant de calculer le score!</p>";
          document.getElementById("scoreDisplay").innerHTML = errormsg;
          document.getElementById("results").style.display = "block";
          document.getElementById('savePdfButton').style.display = "none";
          document.getElementById('saveXLSbutton').style.display = "none";
          document.getElementById("ID").style.display = "none";
          document.getElementById("labelId").style.display = "none";
          return;

        }

        // Compute average scores
        let scorePF = scoreQ2/6;
        let scoreRP = (scoreQ4 + scoreQ5)/2;
        let scoreBP = scoreQ3;
        let scoreSF = scoreQ6_a;
        let scoreMH = (scoreQ6_b+scoreQ6_c+scoreQ6_d+scoreQ6_e+scoreQ6_f)/5;
        let scoreHT = (scoreQ1 + scoreQ7)/5;

        // Update global results
        SF20.globalPF = scorePF;
        SF20.globalBP = scoreBP;
        SF20.globalRP = scoreRP;
        SF20.globalSF = scoreSF;
        SF20.globalMH = scoreMH;
        SF20.globalHT = scoreHT;

        // Display scores
        display(scorePF, scoreBP, scoreRP, scoreSF, scoreMH, scoreHT);
    }

      function display(scorePF, scoreBP, scoreRP, scoreSF, scoreMH, scoreHT) {

          let displayHtml = "<p>Résultats</p>";
          displayHtml += "<br>";
          displayHtml += "<p> Les scores vont de 0 % (faible niveau qualité de vie) à 100 % (niveau très élevé).</p>";
          displayHtml += "<br>";
          displayHtml += "<ul class='myList'>";
          displayHtml += "<li>Activité physique : " + scorePF.toFixed(2) + " % </li>";
          displayHtml += "<li>Limitations dues à l’état physique : " + scoreRP.toFixed(2) + " % </li>";
          displayHtml += "<li>Douleur  : " + scoreBP.toFixed(2) + " % </li>";
          displayHtml += "<li>Vie et relation avec les autres  : " + scoreSF.toFixed(2) + " % </li>";
          displayHtml += "<li>Bien-être émotionnelle : " + scoreMH.toFixed(2) + " % </li>";
          displayHtml += "<li>Évolution de la santé perçue  : " + scoreHT.toFixed(2) + " % </li>";
          displayHtml += "</ul>";

          // Update the results div with the constructed HTML
          document.getElementById("scoreDisplay").innerHTML = displayHtml;
          document.getElementById("results").style.display = "block";
          document.getElementById('savePdfButton').style.display = 'inline-block';
          document.getElementById('saveXLSbutton').style.display = 'inline-block';
          document.getElementById("ID").style.display = 'inline-block';
          document.getElementById("labelId").style.display = 'inline-block';
      }

    
      function saveXLS() {

        const subjectCode = document.getElementById('ID').value || "SansNom"; // Nom du sujet
        const today = new Date().toLocaleDateString('fr-FR');
        const filename = `SF20v1.0${today}_${subjectCode}.csv`;

        const safePF = typeof SF20.globalPF === 'number' ? SF20.globalPF.toFixed(2) : "NA";
        const safeBP = typeof SF20.globalBP === 'number' ? SF20.globalBP.toFixed(2) : "NA";
        const safeRP = typeof SF20.globalRP === 'number' ? SF20.globalRP.toFixed(2) : "NA";
        const safeSF = typeof SF20.globalSF === 'number' ? SF20.globalSF.toFixed(2) : "NA";
        const safeMH = typeof SF20.globalMH === 'number' ? SF20.globalMH.toFixed(2) : "NA";
        const safeHT = typeof SF20.globalHT === 'number' ? SF20.globalHT.toFixed(2) : "NA";

        const allQuestionNames = [
          'q1', 
          'q2a', 'q2b', 'q2c', 'q2d', 'q2e', 'q2f',
          'q3',
          'q4',
          'q5',
          'q6a', 'q6b', 'q6c', 'q6d', 'q6e', 'q6f',
          'q7a', 'q7b', 'q7c', 'q7d',
        ];

        let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
        csvContent += "Sujet,Date,Questionnaire,PF,BP,RP,SF,MH,HT";
        for (let i = 0; i <20; i++) {
          csvContent += `,"${allQuestionNames[i]}"`;
        }
        csvContent += "\n";

        let row =       `"${subjectCode}","${today}","SF20v1","${safePF}","${safeBP}","${safeRP}","${safeSF}","${safeMH}","${safeHT}"`;
        allQuestionNames.forEach(name => {
        let selectedInput = document.querySelector(`input[name="${name}"]:checked`);
        let value = selectedInput ? selectedInput.value : "NA";
        row += `,"${value}"`;
        });

        csvContent += row + "\n";
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

      }

  
      function resetForm() {

        document.getElementById("SF20").reset();
        document.getElementById("ID").value = ""; 
        document.getElementById("scoreDisplay").innerHTML = "";
        document.getElementById("results").style.display = "none";

      }

    
    </script>
  </body>
</html>



