<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Author's details-->
  <meta name="author" content="Nicolas Vannson">
  <meta name="contact" content="hello@memau.eu">
  <meta name="license" content="EUPLv1.2">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="/style.css">
  <style>
    /* style is within the style.css sheet */
  </style>
  <title>SF12v1.0</title>
</head>
<body>   
  <h1>Questionnaire d'état de santé SF-12 version 1.0</h1>
  <p> Ware & Sherbourne, 1992 (version originale)<br>
    Gandek et al., 1998 (version validée en français)</p>
  <p> La version de ce questionnaire est libre (non propriétaire).</p>
       
  <p ><b>COMMENT REPONDRE:</b></p>
  <p >Les questions, qui suivent, portent sur votre état de santé tel que vous le ressentez. Ces informations nous permettront de mieux savoir comment vous vous sentez dans la vie de tous les jours. <b>Veuillez répondre à toutes les questions</b> en cochant la case correspondant à la réponse choisie. Si vous ne savez pas très bien comment répondre, choisissez la réponse la plus adaptée à votre situation.</p>
  <br>
  

  <form id="SF12">

    <table>
      
        <tr>
          <th colspan="5" class="Question_SF36">
            1. Dans l'ensemble, pensez-vous que votre santé est :
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q1" value="5"> Excellente</label></td>
          <td><label><input type="radio" name="q1" value="4"> Très bonne</label></td>
          <td><label><input type="radio" name="q1" value="3"> Bonne</label></td>
          <td><label><input type="radio" name="q1" value="2"> Médiocre</label></td>
          <td><label><input type="radio" name="q1" value="1"> Mauvaise</label></td>
        </tr>
      
    </table>

    <table>
      
        <tr>
          <th colspan="4" class="Question_SF36">
            2. Voici une liste d'activités que vous pouvez avoir à faire dans votre vie de tous les jours. Pour chacune d'entre elles indiquez si vous êtes limité(e) en raison de votre état de santé actuel.
          </th>
        </tr>
        <tr>
          <th style="text-align: center;color:black; ">Listes d'activités</th>
          <th class="response-options">Oui, beaucoup limité(e)</th>
          <th class="response-options">Oui, un peu limité(e)</th>
          <th class="response-options">Non, Pas du tout limité(e)</th>
        </tr>
      
      
        <tr>
          <td class="Question_SF36">a. Efforts physiques importants tels que courir, soulever un objet lourd, faire du sport</td>
          <td><label><input type="radio" name="q2a" value="1"></label></td>
          <td><label><input type="radio" name="q2a" value="2"></label></td>
          <td><label><input type="radio" name="q2a" value="3"></label></td>
        </tr>
        <tr>
          <td class="Question_SF36">b. Marcher plus d'un kilomètre à pied</td>
          <td><label><input type="radio" name="q2b" value="1"></label></td>
          <td><label><input type="radio" name="q2b" value="2"></label></td>
          <td><label><input type="radio" name="q2b" value="3"></label></td>
        </tr>
      
    </table>

    <table>
      
        <tr>
          <th colspan="3" class="Question_SF36">
            3. Au cours de ces 4 dernières semaines, et en raison de votre état physique :
          </th>
        </tr>
        <tr>
          <th></th>
          <th class="response-options">OUI</th>
          <th class="response-options">NON</th>
        </tr>
      
      
        <tr>
          <td class="Question_SF36">a. Avez-vous réduit le temps passé à votre travail ou à vos activités habituelles ?</td>
          <td><label><input type="radio" name="q3a" value="0"></label></td>
          <td><label><input type="radio" name="q3a" value="1"></label></td>
        </tr>
        <tr>
          <td class="Question_SF36">b. Avez-vous accompli moins de choses que vous auriez souhaitées ?</td>
          <td><label><input type="radio" name="q3b" value="0"></label></td>
          <td><label><input type="radio" name="q3b" value="1"></label></td>
        </tr>
      
    </table>

    <table>
      
        <tr>
          <th colspan="6" class="Question_SF36">
            4. Au cours de ces 4 dernières semaines, quelle a été l'intensité de vos douleurs physiques ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q4" value="6"> Nulle</label></td>
          <td><label><input type="radio" name="q4" value="5"> Très faible</label></td>
          <td><label><input type="radio" name="q4" value="4"> Faible</label></td>
          <td><label><input type="radio" name="q4" value="3"> Moyenne</label></td>
          <td><label><input type="radio" name="q4" value="2"> Grande</label></td>
          <td><label><input type="radio" name="q4" value="1"> Très grande</label></td>
        </tr>
      
    </table>

    <table>
      
        <tr>
          <th colspan="5" class="Question_SF36">
            5. Je m'attends à ce que ma santé se dégrade :
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q5" value="1"> Totalement vrai</label></td>
          <td><label><input type="radio" name="q5" value="2"> Plutôt vrai</label></td>
          <td><label><input type="radio" name="q5" value="3"> Je ne sais pas</label></td>
          <td><label><input type="radio" name="q5" value="4"> Plutôt faux</label></td>
          <td><label><input type="radio" name="q5" value="5"> Totalement faux</label></td>
        </tr>

    </table>

    <table>
          <th colspan="7" class="Question_SF36">
            6. Au cours de ces 4 dernières semaines, y a-t-il eu des moments où : Vous vous êtes senti(e) dynamique ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q6" value="6"> En permanence</label></td>
          <td><label><input type="radio" name="q6" value="5"> Très souvent</label></td>
          <td><label><input type="radio" name="q6" value="4"> Souvent</label></td>
          <td><label><input type="radio" name="q6" value="3"> Quelquefois</label></td>
          <td><label><input type="radio" name="q6" value="2"> Rarement</label></td>
          <td><label><input type="radio" name="q6" value="1"> Jamais</label></td>
        </tr>
    </table>

    <table>
        <tr>
          <th colspan="5" class="Question_SF36">
            7. Au cours de ces 4 dernières semaines, dans quelle mesure votre état de santé, physique ou émotionnel, vous a-t-il gêné dans votre vie sociale et vos relations avec les autres, votre famille, vos amis, vos connaissances ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q7" value="5"> Pas du tout</label></td>
          <td><label><input type="radio" name="q7" value="4"> Un petit peu</label></td>
          <td><label><input type="radio" name="q7" value="3"> Moyennement</label></td>
          <td><label><input type="radio" name="q7" value="2"> Beaucoup</label></td>
          <td><label><input type="radio" name="q7" value="1"> Enormément</label></td>
        </tr>
    </table>

    <table>
        <tr>
          <th colspan="3" class="Question_SF36">
            8. Au cours de ces 4 dernières semaines, et en raison de votre état émotionnel (comme vous sentir triste, nerveux (se) ou déprimé(e) :
          </th>
        </tr>
        <tr>
          <th></th>
          <th class="response-options">OUI</th>
          <th class="response-options">NON</th>
        </tr>
        <tr>
          <td class="Question_SF36">a. Avez-vous réduit le temps passé à votre travail ou à vos activités habituelles ?</td>
          <td><label><input type="radio" name="q8a" value="1"></label></td>
          <td><label><input type="radio" name="q8a" value="2"></label></td>
        </tr>
        <tr>
          <td class="Question_SF36">b. Avez-vous accompli moins de choses que vous auriez souhaitées ?</td>
          <td><label><input type="radio" name="q8b" value="1"></label></td>
          <td><label><input type="radio" name="q8b" value="2"></label></td>
        </tr>
    </table>

    <table>
        <tr>
          <th colspan="7" class="Question_SF36">
            9. Au cours de ces 4 dernières semaines, y a-t-il eu des moments où : Vous vous êtes senti(e) calme et détendu(e) ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q9" value="6"> En permanence</label></td>
          <td><label><input type="radio" name="q9" value="5"> Très souvent</label></td>
          <td><label><input type="radio" name="q9" value="4"> Souvent</label></td>
          <td><label><input type="radio" name="q9" value="3"> Quelquefois</label></td>
          <td><label><input type="radio" name="q9" value="2"> Rarement</label></td>
          <td><label><input type="radio" name="q9" value="1"> Jamais</label></td>
        </tr>
      
    </table>

    <table>
      
        <tr>
          <th colspan="7" class="Question_SF36">
            10. Au cours de ces 4 dernières semaines, y a-t-il eu des moments où : Vous vous êtes senti(e) triste et abattu(e) ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q10" value="1"> En permanence</label></td>
          <td><label><input type="radio" name="q10" value="2"> Très souvent</label></td>
          <td><label><input type="radio" name="q10" value="3"> Souvent</label></td>
          <td><label><input type="radio" name="q10" value="4"> Quelquefois</label></td>
          <td><label><input type="radio" name="q10" value="5"> Rarement</label></td>
          <td><label><input type="radio" name="q10" value="6"> Jamais</label></td>
        </tr>
      
    </table>

    <table>
        <tr>
          <th colspan="7" class="Question_SF36">
            11. Au cours de ces 4 dernières semaines, y a-t-il eu des moments où : Vous vous êtes senti(e) épuisé(e) ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q11" value="1"> En permanence</label></td>
          <td><label><input type="radio" name="q11" value="2"> Très souvent</label></td>
          <td><label><input type="radio" name="q11" value="3"> Souvent</label></td>
          <td><label><input type="radio" name="q11" value="4"> Quelquefois</label></td>
          <td><label><input type="radio" name="q11" value="5"> Rarement</label></td>
          <td><label><input type="radio" name="q11" value="6"> Jamais</label></td>
        </tr>
    </table>

    <table>
        <tr>
          <th colspan="5" class="Question_SF36">
            12. Par rapport à l'année dernière à la même époque, comment trouvez-vous votre état de santé en ce moment ?
          </th>
        </tr>
        <tr>
          <td><label><input type="radio" name="q12" value="5">Bien meilleur que l'an dernier</label></td>
          <td><label><input type="radio" name="q12" value="4"> Plutôt meilleur que l'an dernier</label></td>
          <td><label><input type="radio" name="q12" value="3"> À peu près pareil</label></td>
          <td><label><input type="radio" name="q12" value="2"> Plutôt moins bon</label></td>
          <td><label><input type="radio" name="q12" value="1"> Beaucoup moins bon</label></td>
        </tr>
      
    </table>

    <div class="buttons-container">
  <button type="button" onclick="calculateScore()">Calculer le score</button>
  <button type="reset" onclick="resetForm()">Réinitialiser</button>
  </div>

  <div id="results" style="display:none">
        <p id="scoreDisplay"></p><br>
        <label id ="labelId" for="nameID" class="Subject_name">Nom du sujet (si besoin)</label>
        <input type="text" id="ID" name="nameID"><br>
        <button id="savePdfButton" onclick="savePdf()">Exporter en PDF</button>
        <button id="saveXLSbutton" onclick="saveXLS()">Exporter en XLS</button>
      </div>
  </form>

  <script>

  const SF12 = {
          MCS: null,
          PCS: null,
        };


    function calculateScore() {
      const form = document.getElementById('SF12');
      let answeredQuestionsCount = 0;
      const totalQuestions = 15; // Total individual radio button inputs to validate

      const getRadioValue = (name) => {
        const radios = form.elements[name];
        if (radios) {
          let checkedValue = null;
          for (let i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
              checkedValue = parseInt(radios[i].value);
              answeredQuestionsCount++; 
              break;
            }
          }
          return checkedValue; 
        }
        return null; 
      };

      // Collect raw scores for each individual item (as per HTML value attributes)
      const q1 = getRadioValue('q1');
      const q2a = getRadioValue('q2a');
      const q2b = getRadioValue('q2b');
      const q3a = getRadioValue('q3a');
      const q3b = getRadioValue('q3b');
      const q4 = getRadioValue('q4');
      const q5 = getRadioValue('q5');
      const q6 = getRadioValue('q6');
      const q7 = getRadioValue('q7');
      const q8a = getRadioValue('q8a');
      const q8b = getRadioValue('q8b');
      const q9 = getRadioValue('q9');
      const q10 = getRadioValue('q10');
      const q11 = getRadioValue('q11');
      const q12 = getRadioValue('q12');

      // Check if all questions are answered
      if (answeredQuestionsCount < totalQuestions) {
      
          let errormsg = "<p class=Error_message_not_all_answered>Veuillez répondre svp à toutes les questions avant de calculer le score!</p>";

          document.getElementById("scoreDisplay").innerHTML = errormsg;

          document.getElementById("results").style.display = "block";
          document.getElementById('savePdfButton').style.display = "none";
          document.getElementById('saveXLSbutton').style.display = "none";
          document.getElementById("ID").style.display = "none";
          document.getElementById("labelId").style.display = "none";

      return; 
      }

      
      let rawPF = q2a + q2b;
      let rawRP = q3a + q3b
      let rawBP = q4; 
      let rawGH = q1 + q5; 
      let rawVT = q6 + q11;
      let rawSF = q7;
      let rawRE = q8a + q8b;
      let rawMH = q9 + q10;

      const minPF = 2, maxPF = 6;
      const minRP = 0, maxRP = 2;
      const minBP = 1, maxBP = 6;
      const minGH = 2, maxGH = 10;
      const minVT = 2, maxVT = 12;
      const minSF = 1, maxSF = 5;
      const minRE = 0, maxRE = 2;
      const minMH = 2, maxMH = 12;

      const normalizeTo100 = (rawValue, minVal, maxVal) => {
        return ((rawValue - minVal) / (maxVal - minVal)) * 100;
      };

      let scorePF100 = normalizeTo100(rawPF, minPF, maxPF);
      let scoreRP100 = normalizeTo100(rawRP, minRP, maxRP);
      let scoreBP100 = normalizeTo100(rawBP, minBP, maxBP);
      let scoreGH100 = normalizeTo100(rawGH, minGH, maxGH);
      let scoreVT100 = normalizeTo100(rawVT, minVT, maxVT);
      let scoreSF100 = normalizeTo100(rawSF, minSF, maxSF);
      let scoreRE100 = normalizeTo100(rawRE, minRE, maxRE);
      let scoreMH100 = normalizeTo100(rawMH, minMH, maxMH);

      // --- Step 3: US Population Norms (Means and Standard Deviations) and Factor Coefficients for SF-12v2 ---
      
      // Means (M) and Standard Deviations (SD) of the 0-100 transformed scales for US general population
      // These are often reported for the SF-36, and adapted for SF-12.
      const M_PF = 84.52404, SD_PF = 22.89490;
      const M_RP = 81.19907, SD_RP = 33.79729;
      const M_BP = 75.49196, SD_BP = 23.055879;
      const M_GH = 72.21316, SD_GH = 20.16964;
      const M_VT = 61.05453, SD_VT = 20.86942;
      const M_SF = 83.59753, SD_SF = 22.37649;
      const M_RE = 81.29467, SD_RE = 33.02717;
      const M_MH = 74.84212, SD_MH = 18.01189;

      // Z-scores for each health scale (Standardized scores)
      // Z = (Score - Mean) / Standard Deviation
      let Z_PF = (scorePF100 - M_PF) / SD_PF;
      let Z_RP = (scoreRP100 - M_RP) / SD_RP;
      let Z_BP = (scoreBP100 - M_BP) / SD_BP;
      let Z_GH = (scoreGH100 - M_GH) / SD_GH;
      let Z_VT = (scoreVT100 - M_VT) / SD_VT;
      let Z_SF = (scoreSF100 - M_SF) / SD_SF;
      let Z_RE = (scoreRE100 - M_RE) / SD_RE;
      let Z_MH = (scoreMH100 - M_MH) / SD_MH;


      // Factor Score Coefficients for PCS and MCS (US population norms for SF-12v2)
      const pcsCoeff = {
        PF: 0.42402, RP: 0.35165, BP: 0.31757, GH: 0.24954,
        VT: 0.02103, SF: -0.00946, RE: -0.10200, MH: -0.21481
      };
      const mcsCoeff = {
        PF: -0.22999, RP: -0.12329, BP: -0.09700, GH: -0.15049,
        VT: 0.40375, SF: 0.40422, RE: 0.43402, MH: 0.48581
      };

      // Calculate Unstandardized PCS and MCS scores
      let unstandardizedPCS =
          (Z_PF * pcsCoeff.PF) +
          (Z_RP * pcsCoeff.RP) +
          (Z_BP * pcsCoeff.BP) +
          (Z_GH * pcsCoeff.GH) +
          (Z_VT * pcsCoeff.VT) +
          (Z_SF * pcsCoeff.SF) +
          (Z_RE * pcsCoeff.RE) +
          (Z_MH * pcsCoeff.MH);

      let unstandardizedMCS =
          (Z_PF * mcsCoeff.PF) +
          (Z_RP * mcsCoeff.RP) +
          (Z_BP * mcsCoeff.BP) +
          (Z_GH * mcsCoeff.GH) +
          (Z_VT * mcsCoeff.VT) +
          (Z_SF * mcsCoeff.SF) +
          (Z_RE * mcsCoeff.RE) +
          (Z_MH * mcsCoeff.MH);

      // --- Step 4: Standardize PCS and MCS to a mean of 50 and SD of 10 ---
      // Raw PCS/MCS = (Sum of Z-scores * Coefficients)
     
      let PCS = (unstandardizedPCS * 10) + 50;
      let MCS = (unstandardizedMCS * 10) + 50;

      // Display results
      display (MCS,PCS);

      // Store global values
      SF12.MCS = MCS;
      SF12.PCS = PCS;

  }

  function  display (MCS,PCS) {
  
      let displayHtml = "<p>Résultats</p>";
      displayHtml += "<br>";
      displayHtml += "<p>Les scores du SF12 version 1.0 se comparent avec les scores obtenus au sein la population US de 1994. Moyenne (+/-EC) MCS et PCS 50 (+/-10).</p>";
      displayHtml += "<br>";
      displayHtml += "<ul class='myList'>";
      displayHtml += "<li>Composante Mentale (MCS-12) : " +  MCS.toFixed(2) + "</li>";
      displayHtml += "<li>Composante Physique (PCS-12) : " + PCS.toFixed(2)+ "</li>"; 
      displayHtml += "<ul>";

      // Update the results div with the constructed HTML
      document.getElementById("scoreDisplay").innerHTML = displayHtml;
      document.getElementById("results").style.display = "block";
      document.getElementById('savePdfButton').style.display = 'inline-block';
      document.getElementById('saveXLSbutton').style.display = 'inline-block';
  }

  function resetForm() {
      document.getElementById("SF12").reset();
      document.getElementById("scoreDisplay").innerHTML = "";
      document.getElementById("results").style.display = "none";
  }

  function saveXLS() {

    const subjectCode = document.getElementById('ID').value || "SansNom";
    const today = new Date().toLocaleDateString('fr-FR');
    const filename = `SF12v1.0_${today}_${subjectCode}.csv`;

    // Calculer les scores
    const safeMCS = typeof SF12.MCS === 'number' ? SF12.MCS.toFixed(2) : "NA";
    const safePCS = typeof SF12.PCS === 'number' ? SF12.PCS.toFixed(2) : "NA";
    

    // List all items
    const allQuestionNames = [
          'q1', 
          'q2a','q2b',
          'q3a', 'q3b', 
          'q4',
          'q5', 
          'q6', 
          'q7', 
          'q8a','q8b',
          'q9', 
          'q10',
          'q11',
          'q12',
        ];


    // Récupérer les réponses
    const answers = allQuestionNames.map(name => {
        const selectedOption = document.querySelector(`input[name="${name}"]:checked`);
        return selectedOption ? selectedOption.value : "NA";
    });

    
    // Créer le contenu CSV
    let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
    const headers = ["Sujet", "Date", "Questionnaire", "MCS", "PCS", ...allQuestionNames];
    csvContent += headers.join(",") + "\n";

    const row = [`"${subjectCode}"`, `"${today}"`, `"SF12v1.0"`, `"${safeMCS}"`, `"${safePCS}"`, ...answers];
    csvContent += row.join(",") + "\n";


    // Télécharger le fichier
    const link = document.createElement("a");
    link.setAttribute("href", encodeURI(csvContent));
    link.setAttribute("download", filename);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    }

    function savePdf() {

      const { jsPDF } = window.jspdf;
      const today = new Date().toLocaleDateString('fr-FR');
      const subjectCode = document.getElementById('ID').value || "SansNom";
      const filename = `SF12v1.0_${today}_${subjectCode}.pdf`;

      const safeMCS = typeof SF12?.MCS === 'number' ? SF12.MCS.toFixed(2) : "NA";
      const safePCS = typeof SF12?.PCS === 'number' ? SF12.PCS.toFixed(2) : "NA";

      const allQuestionNames = [
        'q1', 'q2a','q2b', 'q3a','q3b', 'q4','q5','q6','q7',
        'q8a','q8b','q9','q10','q11','q12'
      ];

      let data2table = "<table>";
      const answers = allQuestionNames.map((name, index) => {
        const selectedOption = document.querySelector(`input[name="${name}"]:checked`);
        const answer = selectedOption ? selectedOption.value : "NA";
        if (index % 2 === 0) data2table += "<tr>";
        data2table += `<td>${name.toUpperCase()} : ${answer}</td>`;
        if (index % 2 === 1 || index === allQuestionNames.length - 1) data2table += "</tr>";
        return answer;
      });
      data2table += "</table>";


      const content = document.createElement('div');
      content.innerHTML = `
        <style>
        @page {
            size: A4;
            margin: 0;
          }  
        .header_report,
        .body_report,
        .footer_report {
        text-align: center;
        margin: 0 auto;
        width: 100%;
        }
        .header_report {
        padding-top: 4%;
        padding-bottom: 4%;
        background-color:white; /*color for test*/
        border-bottom: 1px solid #2B176C;
        }
        .footer_report {
        padding-top: 3%;
        padding-bottom:3%;

        }
        .body_report {
        padding-top: 5%;
        padding-bottom:20%;
        background-color: white;
        color: black; 
        }


        table {
          border-collapse: collapse;
          width: 80%;
          margin-top: 20px;
          margin: 0 auto;
        }

        th, td {
          padding: 6px 12px;
          border: 1px solid #eeeeee;
      }
        td strong {
          display: block;
          text-align: left;
        }


        </style>
        <div class="header_report">
        <img src="https://data.memau.eu/wp-content/uploads/2025/06/logo-memau-data.svg" alt="Logo" style="max-width: 210px; 
        margin-top: 10px;margin-bottom: 5px;">
        <p><i>Contact : hello@memau.eu </i></p>
              </div>    
        <div class="body_report">
          <h1>SF12v1.0</h1>
          <p>Code du Sujet : ${subjectCode} </p>
          <p>Rapport généré le : ${today}</p>
          <p>Composante Mentale (MCS-12):&nbsp;${safeMCS}</p>
          <p>Composante Physique (PCS-12):&nbsp;${safePCS}</p>
          <p>Score brut de chaque question</p>
          <div class="data2columns">
            ${data2table}
          </div>
        </div>
        `;



        document.body.appendChild(content);

        // Use html2pdf to convert the HTML content to PDF
        const opt = {
          margin: [10, 10, 10, 10], // Adjusted margin to ensure content is visible
          filename: filename,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2, useCORS: true,scrollY: 0 },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        // Generate PDF from HTML content
        html2pdf().set(opt).from(content).save().then(() => {
          document.body.removeChild(content);
        });
      }




      
  </script>
</body>
</html>

